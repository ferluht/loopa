\hypertarget{_tape_8h_source}{}\doxysection{Tape.\+h}
\label{_tape_8h_source}\index{effects\_audio/Tape/Tape.h@{effects\_audio/Tape/Tape.h}}

\begin{DoxyCode}{0}
\DoxyCodeLine{1 \textcolor{comment}{//}}
\DoxyCodeLine{2 \textcolor{comment}{// Created by ferluht on 10/07/2022.}}
\DoxyCodeLine{3 \textcolor{comment}{//}}
\DoxyCodeLine{4 }
\DoxyCodeLine{5 \textcolor{preprocessor}{\#pragma once}}
\DoxyCodeLine{6 }
\DoxyCodeLine{7 \textcolor{preprocessor}{\#include <AudioEffects.h>}}
\DoxyCodeLine{8 \textcolor{preprocessor}{\#include <vector>}}
\DoxyCodeLine{9 \textcolor{preprocessor}{\#include <cmath>}}
\DoxyCodeLine{10 \textcolor{preprocessor}{\#include <iostream>}}
\DoxyCodeLine{11 \textcolor{preprocessor}{\#include <Utils.hpp>}}
\DoxyCodeLine{12 }
\DoxyCodeLine{13 \textcolor{keyword}{class }\mbox{\hyperlink{class_tape}{Tape}} : \textcolor{keyword}{public} \mbox{\hyperlink{class_audio_effect}{AudioEffect}} \{}
\DoxyCodeLine{14 }
\DoxyCodeLine{15     \textcolor{keyword}{const} \textcolor{keywordtype}{int} TAPE\_MAX\_MINUTES = 6;}
\DoxyCodeLine{16 }
\DoxyCodeLine{17     \textcolor{keywordtype}{float} s\_phase = 0;}
\DoxyCodeLine{18 }
\DoxyCodeLine{19     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} doubling\_progress = 0;}
\DoxyCodeLine{20     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} doubling\_size = 0;}
\DoxyCodeLine{21     \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} max\_doubling\_stepsize = 8192;}
\DoxyCodeLine{22     \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} max\_loop\_size = TAPE\_MAX\_MINUTES*60*SAMPLERATE;}
\DoxyCodeLine{23 }
\DoxyCodeLine{24     \textcolor{keywordtype}{int} looper\_state = STOP;}
\DoxyCodeLine{25 }
\DoxyCodeLine{26     \textcolor{keywordtype}{bool} waitingforsync = \textcolor{keyword}{false};}
\DoxyCodeLine{27 }
\DoxyCodeLine{28     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} position = 0;}
\DoxyCodeLine{29 }
\DoxyCodeLine{30     std::vector<float> audio;}
\DoxyCodeLine{31 }
\DoxyCodeLine{32     \textcolor{keywordtype}{float} avg = 0, avg\_env = 0;}
\DoxyCodeLine{33 }
\DoxyCodeLine{34     \textcolor{keywordtype}{int} tick\_counter = 0;}
\DoxyCodeLine{35 }
\DoxyCodeLine{36     \textcolor{keywordtype}{bool} monitoring = \textcolor{keyword}{true};}
\DoxyCodeLine{37 }
\DoxyCodeLine{38 \textcolor{keyword}{public}:}
\DoxyCodeLine{39 }
\DoxyCodeLine{40     \textcolor{keyword}{enum} TAPE\_STATE \{}
\DoxyCodeLine{41         STOP,}
\DoxyCodeLine{42         PLAY,}
\DoxyCodeLine{43         REC,}
\DoxyCodeLine{44         OVERDUB}
\DoxyCodeLine{45     \};}
\DoxyCodeLine{46 }
\DoxyCodeLine{47     \textcolor{keyword}{static} \textcolor{keyword}{const} \textcolor{keywordtype}{float} looper\_ratio;}
\DoxyCodeLine{48 }
\DoxyCodeLine{49     \mbox{\hyperlink{class_tape}{Tape}}();}
\DoxyCodeLine{50 }
\DoxyCodeLine{51     MIDISTATUS trig();}
\DoxyCodeLine{52     MIDISTATUS clear();}
\DoxyCodeLine{53     MIDISTATUS double\_loop();}
\DoxyCodeLine{54 }
\DoxyCodeLine{55 \textcolor{comment}{//    inline float envelope(float sample, float w, float w\_env) \{}}
\DoxyCodeLine{56 \textcolor{comment}{//        avg = w * sample + (1 -\/ w) * avg;}}
\DoxyCodeLine{57 \textcolor{comment}{//        float i = std::abs(sample -\/ avg);}}
\DoxyCodeLine{58 \textcolor{comment}{//        avg\_env = w\_env * i + (1 -\/ w\_env) * avg\_env;}}
\DoxyCodeLine{59 \textcolor{comment}{//        return avg\_env;}}
\DoxyCodeLine{60 \textcolor{comment}{//    \}}}
\DoxyCodeLine{61 }
\DoxyCodeLine{62     \textcolor{keywordtype}{void} \mbox{\hyperlink{class_tape_a3ca2529191c7710a84709a4fd1a9f406}{process}}(\textcolor{keywordtype}{float} *outputBuffer, \textcolor{keywordtype}{float} * inputBuffer,}
\DoxyCodeLine{63                  \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} nBufferFrames, \textcolor{keywordtype}{double} streamTime) \textcolor{keyword}{override};}
\DoxyCodeLine{64     \textcolor{keywordtype}{void} \mbox{\hyperlink{class_tape_a116ea0f7233a2ed65c01263ef95bec71}{draw}}(GFXcanvas1 * screen) \textcolor{keyword}{override};}
\DoxyCodeLine{65     \textcolor{keywordtype}{float} getPosition();}
\DoxyCodeLine{66     \textcolor{keywordtype}{int} getState();}
\DoxyCodeLine{67 \};}

\end{DoxyCode}
