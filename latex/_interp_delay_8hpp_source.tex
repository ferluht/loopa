\hypertarget{_interp_delay_8hpp_source}{}\doxysection{Interp\+Delay.\+hpp}
\label{_interp_delay_8hpp_source}\index{effects\_audio/Plateau/InterpDelay.hpp@{effects\_audio/Plateau/InterpDelay.hpp}}

\begin{DoxyCode}{0}
\DoxyCodeLine{1 \textcolor{preprocessor}{\#ifndef IND\_HPP}}
\DoxyCodeLine{2 \textcolor{preprocessor}{\#define IND\_HPP}}
\DoxyCodeLine{3 }
\DoxyCodeLine{4 \textcolor{preprocessor}{\#include <vector>}}
\DoxyCodeLine{5 \textcolor{preprocessor}{\#include <cmath>}}
\DoxyCodeLine{6 \textcolor{preprocessor}{\#include <pmmintrin.h>}}
\DoxyCodeLine{7 \textcolor{preprocessor}{\#define MAX\_DELAY\_TAP\_GROUPS 512}}
\DoxyCodeLine{8 \textcolor{preprocessor}{\#define MAX\_DELAY\_LENGTH 65536}}
\DoxyCodeLine{9 }
\DoxyCodeLine{11 \textcolor{keyword}{template}<\textcolor{keyword}{class} T>}
\DoxyCodeLine{12 \textcolor{keyword}{class }InterpDelay}
\DoxyCodeLine{13 \{}
\DoxyCodeLine{14 \textcolor{keyword}{public}:}
\DoxyCodeLine{15     InterpDelay() \{}
\DoxyCodeLine{16         input = 0.0;}
\DoxyCodeLine{17         output = 0.0;}
\DoxyCodeLine{18         delayTime = 0.0;}
\DoxyCodeLine{19         \_length = 2;}
\DoxyCodeLine{20         \_buffer.assign(\_length, 0.0);}
\DoxyCodeLine{21         \_readPos = 1.0;}
\DoxyCodeLine{22         \_phasedPos = 0.0;}
\DoxyCodeLine{23         \_lowerReadPos = 0;}
\DoxyCodeLine{24         \_upperReadPos = 0;}
\DoxyCodeLine{25         \_writePos = 0;}
\DoxyCodeLine{26     \}}
\DoxyCodeLine{27 }
\DoxyCodeLine{28     InterpDelay(\textcolor{keywordtype}{long} maxLength, \textcolor{keywordtype}{long} initDelay) \{}
\DoxyCodeLine{29         input = 0.0;}
\DoxyCodeLine{30         output = 0.0;}
\DoxyCodeLine{31         delayTime = initDelay;}
\DoxyCodeLine{32         \_length = maxLength;}
\DoxyCodeLine{33         \_buffer.assign(\_length, 0.0);}
\DoxyCodeLine{34         \_readPos = maxLength -\/ 1;}
\DoxyCodeLine{35         \_phasedPos = 0;}
\DoxyCodeLine{36         \_lowerReadPos = 0;}
\DoxyCodeLine{37         \_upperReadPos = 0;}
\DoxyCodeLine{38         \_writePos = 0;}
\DoxyCodeLine{39     \}}
\DoxyCodeLine{40 }
\DoxyCodeLine{41     T \textcolor{keyword}{inline} process() \{}
\DoxyCodeLine{42         \_time = delayTime;}
\DoxyCodeLine{43         \textcolor{keywordflow}{if}(\_time < 0.0) \{}
\DoxyCodeLine{44             \_time = 0.0;}
\DoxyCodeLine{45         \}}
\DoxyCodeLine{46         \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(\_time >= \_length) \{}
\DoxyCodeLine{47             \_time = \_length -\/ 1;}
\DoxyCodeLine{48         \}}
\DoxyCodeLine{49         \_buffer[\_writePos] = input;}
\DoxyCodeLine{50         \_phasedPos = (T)\_writePos -\/ \_time;}
\DoxyCodeLine{51         \textcolor{keywordflow}{if}(\_phasedPos < 0.0) \{}
\DoxyCodeLine{52             \_phasedPos += (T)\_length;}
\DoxyCodeLine{53         \}}
\DoxyCodeLine{54         \_lowerReadPos = (long)\_phasedPos;}
\DoxyCodeLine{55         \_upperReadPos = \_lowerReadPos + 1;}
\DoxyCodeLine{56         \textcolor{keywordflow}{if}(\_upperReadPos >= \_length) \{}
\DoxyCodeLine{57             \_upperReadPos -\/= \_length;}
\DoxyCodeLine{58         \}}
\DoxyCodeLine{59         \_ratio = \_phasedPos -\/ \_lowerReadPos;}
\DoxyCodeLine{60 }
\DoxyCodeLine{61         output = \_buffer[\_lowerReadPos] + \_ratio * (\_buffer[\_upperReadPos] -\/ \_buffer[\_lowerReadPos]);}
\DoxyCodeLine{62         \_writePos++;}
\DoxyCodeLine{63         \textcolor{keywordflow}{if}(\_writePos >= \_length) \{}
\DoxyCodeLine{64             \_writePos -\/= \_length;}
\DoxyCodeLine{65         \}}
\DoxyCodeLine{66 }
\DoxyCodeLine{67         \textcolor{keywordflow}{return} output;}
\DoxyCodeLine{68     \}}
\DoxyCodeLine{69 }
\DoxyCodeLine{70     T tap(\textcolor{keywordtype}{long} i)\textcolor{keyword}{ const }\{}
\DoxyCodeLine{71         i = \_writePos -\/ i;}
\DoxyCodeLine{72         \textcolor{keywordflow}{if}(i < 0) \{}
\DoxyCodeLine{73             i += \_length;}
\DoxyCodeLine{74         \}}
\DoxyCodeLine{75         \textcolor{keywordflow}{return} \_buffer[i];}
\DoxyCodeLine{76     \}}
\DoxyCodeLine{77 }
\DoxyCodeLine{78     \textcolor{keywordtype}{void} clear() \{}
\DoxyCodeLine{79         \_buffer.assign(\_length, 0);}
\DoxyCodeLine{80         input = 0;}
\DoxyCodeLine{81         output = 0;}
\DoxyCodeLine{82     \}}
\DoxyCodeLine{83 }
\DoxyCodeLine{84     \textcolor{keywordtype}{void} setMaxDelaySamples(\textcolor{keywordtype}{long} maxDelaySamples) \{}
\DoxyCodeLine{85         \_length = maxDelaySamples;}
\DoxyCodeLine{86         \_buffer.assign(\_length, 0);}
\DoxyCodeLine{87     \}}
\DoxyCodeLine{88 }
\DoxyCodeLine{89     T input;}
\DoxyCodeLine{90     T delayTime;}
\DoxyCodeLine{91     T output;}
\DoxyCodeLine{92 \textcolor{keyword}{private}:}
\DoxyCodeLine{93     std::vector<T> \_buffer;}
\DoxyCodeLine{94     \textcolor{keywordtype}{long} \_length;}
\DoxyCodeLine{95     T \_time;}
\DoxyCodeLine{96     T \_readPos;}
\DoxyCodeLine{97     T \_phasedPos;}
\DoxyCodeLine{98     \textcolor{keywordtype}{long} \_upperReadPos;}
\DoxyCodeLine{99     \textcolor{keywordtype}{long} \_lowerReadPos;}
\DoxyCodeLine{100     T \_ratio;}
\DoxyCodeLine{101     \textcolor{keywordtype}{long} \_writePos;}
\DoxyCodeLine{102 \};}
\DoxyCodeLine{103 }
\DoxyCodeLine{105 }
\DoxyCodeLine{107 \textcolor{keyword}{template}<\textcolor{keyword}{class} T, const \textcolor{keywordtype}{int} kNumTaps>}
\DoxyCodeLine{108 \textcolor{keyword}{class }MultiTapInterpDelay \{}
\DoxyCodeLine{109 \textcolor{keyword}{public}:}
\DoxyCodeLine{110     MultiTapInterpDelay() \{}
\DoxyCodeLine{111         \_length = 2;}
\DoxyCodeLine{112         \_buffer.assign(\_length, 0);}
\DoxyCodeLine{113         \textcolor{keywordflow}{for}(\textcolor{keyword}{auto} i = 0; i < kNumTaps; ++i) \{}
\DoxyCodeLine{114             \_output[i] = 0;}
\DoxyCodeLine{115             \_time[i] = 0;}
\DoxyCodeLine{116         \}}
\DoxyCodeLine{117         \_readPos = 1.0;}
\DoxyCodeLine{118         \_phasedPos = 0.0;}
\DoxyCodeLine{119         \_lower = 0;}
\DoxyCodeLine{120         \_upper = 0;}
\DoxyCodeLine{121         \_writePos = 0;}
\DoxyCodeLine{122     \}}
\DoxyCodeLine{123 }
\DoxyCodeLine{124     MultiTapInterpDelay(\textcolor{keywordtype}{long} maxLength) \{}
\DoxyCodeLine{125         \_length = maxLength;}
\DoxyCodeLine{126         \_buffer.assign(\_length, 0);}
\DoxyCodeLine{127         \textcolor{keywordflow}{for}(\textcolor{keyword}{auto} i = 0; i < kNumTaps; ++i) \{}
\DoxyCodeLine{128             \_output[i] = 0;}
\DoxyCodeLine{129             \_time[i] = 0;}
\DoxyCodeLine{130         \}}
\DoxyCodeLine{131         \_readPos = 1.0;}
\DoxyCodeLine{132         \_phasedPos = 0.0;}
\DoxyCodeLine{133         \_lower = 0;}
\DoxyCodeLine{134         \_upper = 0;}
\DoxyCodeLine{135         \_writePos = 0;}
\DoxyCodeLine{136     \}}
\DoxyCodeLine{137 }
\DoxyCodeLine{138     \textcolor{keywordtype}{void} process(T input) \{}
\DoxyCodeLine{139         \_buffer[\_writePos] = input;}
\DoxyCodeLine{140         \textcolor{keywordflow}{for}(\textcolor{keyword}{auto} i = 0; i < kNumTaps; ++i) \{}
\DoxyCodeLine{141             \_phasedPos = (T)\_writePos -\/ \_time[i];}
\DoxyCodeLine{142             \textcolor{keywordflow}{if}(\_phasedPos < 0) \{}
\DoxyCodeLine{143                 \_phasedPos += (T)\_length;}
\DoxyCodeLine{144             \}}
\DoxyCodeLine{145             \_frac = \_phasedPos -\/ (long)\_phasedPos;}
\DoxyCodeLine{146             \_lower = (long)\_phasedPos;}
\DoxyCodeLine{147             \_upper = \_lower + 1;}
\DoxyCodeLine{148             \textcolor{keywordflow}{if}(\_upper >= \_length) \{}
\DoxyCodeLine{149                 \_upper -\/= \_length;}
\DoxyCodeLine{150             \}}
\DoxyCodeLine{151             \_output[i] = \_buffer[\_lower] + \_frac * (\_buffer[\_upper] -\/ \_buffer[\_lower]);}
\DoxyCodeLine{152         \}}
\DoxyCodeLine{153         \_writePos++;}
\DoxyCodeLine{154         \textcolor{keywordflow}{if}(\_writePos >= \_length) \{}
\DoxyCodeLine{155             \_writePos -\/= \_length;}
\DoxyCodeLine{156         \}}
\DoxyCodeLine{157     \}}
\DoxyCodeLine{158 }
\DoxyCodeLine{159     T operator[](\textcolor{keyword}{const} \textcolor{keywordtype}{int} i)\textcolor{keyword}{ const }\{}
\DoxyCodeLine{160         \textcolor{keywordflow}{return} \_output[i];}
\DoxyCodeLine{161     \}}
\DoxyCodeLine{162 }
\DoxyCodeLine{163     \textcolor{keywordtype}{void} setDelaySamples(\textcolor{keywordtype}{int} tap, T dSamples) \{}
\DoxyCodeLine{164         \_time[tap] = dSamples;}
\DoxyCodeLine{165     \}}
\DoxyCodeLine{166 }
\DoxyCodeLine{167     \textcolor{keywordtype}{void} clear() \{}
\DoxyCodeLine{168         \_buffer.assign(\_length, 0);}
\DoxyCodeLine{169         \textcolor{keywordflow}{for}(\textcolor{keyword}{auto} i = 0; i < kNumTaps; ++i) \{}
\DoxyCodeLine{170             \_output[i] = 0;}
\DoxyCodeLine{171         \}}
\DoxyCodeLine{172     \}}
\DoxyCodeLine{173 \textcolor{keyword}{private}:}
\DoxyCodeLine{174     std::vector<T> \_buffer;}
\DoxyCodeLine{175     \textcolor{keywordtype}{long} \_length;}
\DoxyCodeLine{176     T \_output[kNumTaps];}
\DoxyCodeLine{177     T \_time[kNumTaps];}
\DoxyCodeLine{178     \textcolor{keywordtype}{long} \_readPos;}
\DoxyCodeLine{179     T \_phasedPos;}
\DoxyCodeLine{180     \textcolor{keywordtype}{long} \_upper;}
\DoxyCodeLine{181     \textcolor{keywordtype}{long} \_lower;}
\DoxyCodeLine{182     T \_frac;}
\DoxyCodeLine{183     \textcolor{keywordtype}{long} \_writePos;}
\DoxyCodeLine{184 \};}
\DoxyCodeLine{185 }
\DoxyCodeLine{186 \textcolor{preprocessor}{\#endif}}

\end{DoxyCode}
