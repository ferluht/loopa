\hypertarget{_daw_8h_source}{}\doxysection{Daw.\+h}

\begin{DoxyCode}{0}
\DoxyCodeLine{1 \textcolor{comment}{//}}
\DoxyCodeLine{2 \textcolor{comment}{// Created by ferluht on 07/07/2022.}}
\DoxyCodeLine{3 \textcolor{comment}{//}}
\DoxyCodeLine{4 }
\DoxyCodeLine{5 \textcolor{preprocessor}{\#pragma once}}
\DoxyCodeLine{6 }
\DoxyCodeLine{7 \textcolor{preprocessor}{\#include <cstdint>}}
\DoxyCodeLine{8 \textcolor{preprocessor}{\#include <AMG.h>}}
\DoxyCodeLine{9 \textcolor{preprocessor}{\#include <Instruments.h>}}
\DoxyCodeLine{10 \textcolor{preprocessor}{\#include <AudioEffects.h>}}
\DoxyCodeLine{11 \textcolor{preprocessor}{\#include <MidiEffects.h>}}
\DoxyCodeLine{12 \textcolor{preprocessor}{\#include <Ui.h>}}
\DoxyCodeLine{13 \textcolor{preprocessor}{\#include <unistd.h>}}
\DoxyCodeLine{14 \textcolor{preprocessor}{\#include <chrono>}}
\DoxyCodeLine{15 \textcolor{preprocessor}{\#include <mutex>}}
\DoxyCodeLine{16 }
\DoxyCodeLine{17 \textcolor{preprocessor}{\#define SLEEP( milliseconds ) usleep( (unsigned long) (milliseconds * 1000.0) )}}
\DoxyCodeLine{18 }
\DoxyCodeLine{19 \textcolor{keyword}{class }\mbox{\hyperlink{class_d_a_w}{DAW}} : \textcolor{keyword}{public} \mbox{\hyperlink{class_a_m_g}{AMG}}\{}
\DoxyCodeLine{20 }
\DoxyCodeLine{21 \textcolor{keyword}{public}:}
\DoxyCodeLine{22 }
\DoxyCodeLine{23     \mbox{\hyperlink{class_d_a_w}{DAW}}(GFXcanvas1 * screen\_) : \mbox{\hyperlink{class_d_a_w}{DAW}}(3, 4, screen\_) \{\};}
\DoxyCodeLine{24 }
\DoxyCodeLine{25     \mbox{\hyperlink{class_d_a_w}{DAW}} (\textcolor{keywordtype}{int} n\_tracks, \textcolor{keywordtype}{int} n\_tapes, GFXcanvas1 * screen\_) : \mbox{\hyperlink{class_a_m_g}{AMG}}(\textcolor{stringliteral}{"{}DAW"{}}) \{}
\DoxyCodeLine{26         screen = screen\_;}
\DoxyCodeLine{27 }
\DoxyCodeLine{28         midiMap = \textcolor{keyword}{new} \mbox{\hyperlink{class_m_i_d_i_map}{MIDIMap}}();}
\DoxyCodeLine{29         midiMap-\/>\mbox{\hyperlink{class_m_i_d_i_map_a8a4f41ca5d0f193b72c781e6e4f31424}{addHardwareControl}}(\textcolor{stringliteral}{"{}CTRL"{}}, CC\_HEADER, 100);}
\DoxyCodeLine{30         midiMap-\/>\mbox{\hyperlink{class_m_i_d_i_map_a8a4f41ca5d0f193b72c781e6e4f31424}{addHardwareControl}}(\textcolor{stringliteral}{"{}SHIFT"{}}, CC\_HEADER, 101);}
\DoxyCodeLine{31 }
\DoxyCodeLine{32         midiMap-\/>\mbox{\hyperlink{class_m_i_d_i_map_a8a4f41ca5d0f193b72c781e6e4f31424}{addHardwareControl}}(\textcolor{stringliteral}{"{}P1"{}}, CC\_HEADER, 110);}
\DoxyCodeLine{33         midiMap-\/>\mbox{\hyperlink{class_m_i_d_i_map_a8a4f41ca5d0f193b72c781e6e4f31424}{addHardwareControl}}(\textcolor{stringliteral}{"{}P2"{}}, CC\_HEADER, 111);}
\DoxyCodeLine{34         midiMap-\/>\mbox{\hyperlink{class_m_i_d_i_map_a8a4f41ca5d0f193b72c781e6e4f31424}{addHardwareControl}}(\textcolor{stringliteral}{"{}P3"{}}, CC\_HEADER, 112);}
\DoxyCodeLine{35         midiMap-\/>\mbox{\hyperlink{class_m_i_d_i_map_a8a4f41ca5d0f193b72c781e6e4f31424}{addHardwareControl}}(\textcolor{stringliteral}{"{}P4"{}}, CC\_HEADER, 113);}
\DoxyCodeLine{36 }
\DoxyCodeLine{37         midiMap-\/>\mbox{\hyperlink{class_m_i_d_i_map_a8a4f41ca5d0f193b72c781e6e4f31424}{addHardwareControl}}(\textcolor{stringliteral}{"{}K1"{}}, CC\_HEADER, 60);}
\DoxyCodeLine{38         midiMap-\/>\mbox{\hyperlink{class_m_i_d_i_map_a8a4f41ca5d0f193b72c781e6e4f31424}{addHardwareControl}}(\textcolor{stringliteral}{"{}K2"{}}, CC\_HEADER, 61);}
\DoxyCodeLine{39         midiMap-\/>\mbox{\hyperlink{class_m_i_d_i_map_a8a4f41ca5d0f193b72c781e6e4f31424}{addHardwareControl}}(\textcolor{stringliteral}{"{}K3"{}}, CC\_HEADER, 62);}
\DoxyCodeLine{40         midiMap-\/>\mbox{\hyperlink{class_m_i_d_i_map_a8a4f41ca5d0f193b72c781e6e4f31424}{addHardwareControl}}(\textcolor{stringliteral}{"{}K4"{}}, CC\_HEADER, 63);}
\DoxyCodeLine{41         midiMap-\/>\mbox{\hyperlink{class_m_i_d_i_map_a8a4f41ca5d0f193b72c781e6e4f31424}{addHardwareControl}}(\textcolor{stringliteral}{"{}K5"{}}, CC\_HEADER, 64);}
\DoxyCodeLine{42         midiMap-\/>\mbox{\hyperlink{class_m_i_d_i_map_a8a4f41ca5d0f193b72c781e6e4f31424}{addHardwareControl}}(\textcolor{stringliteral}{"{}K6"{}}, CC\_HEADER, 65);}
\DoxyCodeLine{43         midiMap-\/>\mbox{\hyperlink{class_m_i_d_i_map_a8a4f41ca5d0f193b72c781e6e4f31424}{addHardwareControl}}(\textcolor{stringliteral}{"{}K7"{}}, CC\_HEADER, 66);}
\DoxyCodeLine{44 }
\DoxyCodeLine{45         midiMap-\/>\mbox{\hyperlink{class_m_i_d_i_map_a77f1f550fea05e6d09b23b3bed961297}{addMapping}}(\{\textcolor{stringliteral}{"{}SHIFT"{}}, \textcolor{stringliteral}{"{}K1"{}}\}, DAW\_CTRL\_HEADER, MIDICC::DAW\_LEFT);}
\DoxyCodeLine{46         midiMap-\/>\mbox{\hyperlink{class_m_i_d_i_map_a77f1f550fea05e6d09b23b3bed961297}{addMapping}}(\{\textcolor{stringliteral}{"{}SHIFT"{}}, \textcolor{stringliteral}{"{}K2"{}}\}, DAW\_CTRL\_HEADER, MIDICC::DAW\_DOWN);}
\DoxyCodeLine{47         midiMap-\/>\mbox{\hyperlink{class_m_i_d_i_map_a77f1f550fea05e6d09b23b3bed961297}{addMapping}}(\{\textcolor{stringliteral}{"{}SHIFT"{}}, \textcolor{stringliteral}{"{}K3"{}}\}, DAW\_CTRL\_HEADER, MIDICC::DAW\_RIGHT);}
\DoxyCodeLine{48         midiMap-\/>\mbox{\hyperlink{class_m_i_d_i_map_a77f1f550fea05e6d09b23b3bed961297}{addMapping}}(\{\textcolor{stringliteral}{"{}SHIFT"{}}, \textcolor{stringliteral}{"{}K4"{}}\}, DAW\_CTRL\_HEADER, MIDICC::DAW\_UP);}
\DoxyCodeLine{49 }
\DoxyCodeLine{50         midiMap-\/>\mbox{\hyperlink{class_m_i_d_i_map_a77f1f550fea05e6d09b23b3bed961297}{addMapping}}(\{\textcolor{stringliteral}{"{}P1"{}}\}, CC\_HEADER + 0, MIDICC::TAPE\_TRIG);}
\DoxyCodeLine{51         midiMap-\/>\mbox{\hyperlink{class_m_i_d_i_map_a77f1f550fea05e6d09b23b3bed961297}{addMapping}}(\{\textcolor{stringliteral}{"{}SHIFT"{}}, \textcolor{stringliteral}{"{}P1"{}}\}, CC\_HEADER + 0, MIDICC::TAPE\_CLEAR);}
\DoxyCodeLine{52         midiMap-\/>\mbox{\hyperlink{class_m_i_d_i_map_a77f1f550fea05e6d09b23b3bed961297}{addMapping}}(\{\textcolor{stringliteral}{"{}CTRL"{}}, \textcolor{stringliteral}{"{}P1"{}}\}, CC\_HEADER + 0, MIDICC::TAPE\_DOUBLE);}
\DoxyCodeLine{53         midiMap-\/>\mbox{\hyperlink{class_m_i_d_i_map_a77f1f550fea05e6d09b23b3bed961297}{addMapping}}(\{\textcolor{stringliteral}{"{}SHIFT"{}}, \textcolor{stringliteral}{"{}CTRL"{}}, \textcolor{stringliteral}{"{}P1"{}}\}, CC\_HEADER + 0, MIDICC::TAPE\_STOP);}
\DoxyCodeLine{54 }
\DoxyCodeLine{55         midiMap-\/>\mbox{\hyperlink{class_m_i_d_i_map_a77f1f550fea05e6d09b23b3bed961297}{addMapping}}(\{\textcolor{stringliteral}{"{}P2"{}}\}, CC\_HEADER + 1, MIDICC::TAPE\_TRIG);}
\DoxyCodeLine{56         midiMap-\/>\mbox{\hyperlink{class_m_i_d_i_map_a77f1f550fea05e6d09b23b3bed961297}{addMapping}}(\{\textcolor{stringliteral}{"{}SHIFT"{}}, \textcolor{stringliteral}{"{}P2"{}}\}, CC\_HEADER + 1, MIDICC::TAPE\_CLEAR);}
\DoxyCodeLine{57         midiMap-\/>\mbox{\hyperlink{class_m_i_d_i_map_a77f1f550fea05e6d09b23b3bed961297}{addMapping}}(\{\textcolor{stringliteral}{"{}CTRL"{}}, \textcolor{stringliteral}{"{}P2"{}}\}, CC\_HEADER + 1, MIDICC::TAPE\_DOUBLE);}
\DoxyCodeLine{58         midiMap-\/>\mbox{\hyperlink{class_m_i_d_i_map_a77f1f550fea05e6d09b23b3bed961297}{addMapping}}(\{\textcolor{stringliteral}{"{}SHIFT"{}}, \textcolor{stringliteral}{"{}CTRL"{}}, \textcolor{stringliteral}{"{}P2"{}}\}, CC\_HEADER + 1, MIDICC::TAPE\_STOP);}
\DoxyCodeLine{59 }
\DoxyCodeLine{60         midiMap-\/>\mbox{\hyperlink{class_m_i_d_i_map_a77f1f550fea05e6d09b23b3bed961297}{addMapping}}(\{\textcolor{stringliteral}{"{}P3"{}}\}, CC\_HEADER + 2, MIDICC::TAPE\_TRIG);}
\DoxyCodeLine{61         midiMap-\/>\mbox{\hyperlink{class_m_i_d_i_map_a77f1f550fea05e6d09b23b3bed961297}{addMapping}}(\{\textcolor{stringliteral}{"{}SHIFT"{}}, \textcolor{stringliteral}{"{}P3"{}}\}, CC\_HEADER + 2, MIDICC::TAPE\_CLEAR);}
\DoxyCodeLine{62         midiMap-\/>\mbox{\hyperlink{class_m_i_d_i_map_a77f1f550fea05e6d09b23b3bed961297}{addMapping}}(\{\textcolor{stringliteral}{"{}CTRL"{}}, \textcolor{stringliteral}{"{}P3"{}}\}, CC\_HEADER + 2, MIDICC::TAPE\_DOUBLE);}
\DoxyCodeLine{63         midiMap-\/>\mbox{\hyperlink{class_m_i_d_i_map_a77f1f550fea05e6d09b23b3bed961297}{addMapping}}(\{\textcolor{stringliteral}{"{}SHIFT"{}}, \textcolor{stringliteral}{"{}CTRL"{}}, \textcolor{stringliteral}{"{}P3"{}}\}, CC\_HEADER + 2, MIDICC::TAPE\_STOP);}
\DoxyCodeLine{64 }
\DoxyCodeLine{65         midiMap-\/>\mbox{\hyperlink{class_m_i_d_i_map_a77f1f550fea05e6d09b23b3bed961297}{addMapping}}(\{\textcolor{stringliteral}{"{}P4"{}}\}, CC\_HEADER + 3, MIDICC::TAPE\_TRIG);}
\DoxyCodeLine{66         midiMap-\/>\mbox{\hyperlink{class_m_i_d_i_map_a77f1f550fea05e6d09b23b3bed961297}{addMapping}}(\{\textcolor{stringliteral}{"{}SHIFT"{}}, \textcolor{stringliteral}{"{}P4"{}}\}, CC\_HEADER + 3, MIDICC::TAPE\_CLEAR);}
\DoxyCodeLine{67         midiMap-\/>\mbox{\hyperlink{class_m_i_d_i_map_a77f1f550fea05e6d09b23b3bed961297}{addMapping}}(\{\textcolor{stringliteral}{"{}CTRL"{}}, \textcolor{stringliteral}{"{}P4"{}}\}, CC\_HEADER + 3, MIDICC::TAPE\_DOUBLE);}
\DoxyCodeLine{68         midiMap-\/>\mbox{\hyperlink{class_m_i_d_i_map_a77f1f550fea05e6d09b23b3bed961297}{addMapping}}(\{\textcolor{stringliteral}{"{}SHIFT"{}}, \textcolor{stringliteral}{"{}CTRL"{}}, \textcolor{stringliteral}{"{}P4"{}}\}, CC\_HEADER + 3, MIDICC::TAPE\_STOP);}
\DoxyCodeLine{69 }
\DoxyCodeLine{70         \mbox{\hyperlink{class_m_af2037e5190cff1802d694edd919c9a90}{addMIDIHandler}}(DAW\_CTRL\_HEADER, MIDICC::DAW\_LEFT, [\textcolor{keyword}{this}](\mbox{\hyperlink{struct_m_data}{MData}} \&cmd) -\/> MIDISTATUS \{}
\DoxyCodeLine{71             \textcolor{keywordflow}{if} (cmd.data2 > 0)}
\DoxyCodeLine{72                 this-\/>focus\_rack = this-\/>focus\_rack-\/>dive\_out();}
\DoxyCodeLine{73             \textcolor{keywordflow}{return} MIDISTATUS::DONE;}
\DoxyCodeLine{74         \});}
\DoxyCodeLine{75 }
\DoxyCodeLine{76         \mbox{\hyperlink{class_m_af2037e5190cff1802d694edd919c9a90}{addMIDIHandler}}(DAW\_CTRL\_HEADER, MIDICC::DAW\_DOWN, [\textcolor{keyword}{this}](\mbox{\hyperlink{struct_m_data}{MData}} \&cmd) -\/> MIDISTATUS \{}
\DoxyCodeLine{77             \textcolor{keywordflow}{if} (cmd.data2 > 0)}
\DoxyCodeLine{78                 this-\/>focus\_rack = this-\/>focus\_rack-\/>dive\_next();}
\DoxyCodeLine{79             \textcolor{keywordflow}{return} MIDISTATUS::DONE;}
\DoxyCodeLine{80         \});}
\DoxyCodeLine{81 }
\DoxyCodeLine{82         \mbox{\hyperlink{class_m_af2037e5190cff1802d694edd919c9a90}{addMIDIHandler}}(DAW\_CTRL\_HEADER, MIDICC::DAW\_RIGHT, [\textcolor{keyword}{this}](\mbox{\hyperlink{struct_m_data}{MData}} \&cmd) -\/> MIDISTATUS \{}
\DoxyCodeLine{83             \textcolor{keywordflow}{if} (cmd.data2 > 0)}
\DoxyCodeLine{84                 this-\/>focus\_rack = this-\/>focus\_rack-\/>dive\_in();}
\DoxyCodeLine{85             \textcolor{keywordflow}{return} MIDISTATUS::DONE;}
\DoxyCodeLine{86         \});}
\DoxyCodeLine{87 }
\DoxyCodeLine{88         \mbox{\hyperlink{class_m_af2037e5190cff1802d694edd919c9a90}{addMIDIHandler}}(DAW\_CTRL\_HEADER, MIDICC::DAW\_UP, [\textcolor{keyword}{this}](\mbox{\hyperlink{struct_m_data}{MData}} \&cmd) -\/> MIDISTATUS \{}
\DoxyCodeLine{89             \textcolor{keywordflow}{if} (cmd.data2 > 0)}
\DoxyCodeLine{90                 this-\/>focus\_rack = this-\/>focus\_rack-\/>dive\_prev();}
\DoxyCodeLine{91             \textcolor{keywordflow}{return} MIDISTATUS::DONE;}
\DoxyCodeLine{92         \});}
\DoxyCodeLine{93 }
\DoxyCodeLine{94         tracks = spawnTracksRack(n\_tracks);}
\DoxyCodeLine{95         tapes = \textcolor{keyword}{new} \mbox{\hyperlink{class_tape_rack}{TapeRack}}();}
\DoxyCodeLine{96         focus\_rack = tracks;}
\DoxyCodeLine{97 }
\DoxyCodeLine{98         dawMidiStatus = MIDISTATUS::DONE;}
\DoxyCodeLine{99     \}}
\DoxyCodeLine{100 }
\DoxyCodeLine{101     \textcolor{keywordtype}{void} \mbox{\hyperlink{class_d_a_w_a1faa3a5ecd7e339f27e89ca3c4161d92}{process}}(\textcolor{keywordtype}{float} *outputBuffer, \textcolor{keywordtype}{float} * inputBuffer,}
\DoxyCodeLine{102                  \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} nBufferFrames, \textcolor{keywordtype}{double} streamTime) \textcolor{keyword}{override};}
\DoxyCodeLine{103 }
\DoxyCodeLine{104     MIDISTATUS \mbox{\hyperlink{class_d_a_w_a9cc872796552800491c7a2e5079904ee}{midiIn}}(\mbox{\hyperlink{struct_m_data}{MData}}\& cmd) \textcolor{keyword}{override};}
\DoxyCodeLine{105 }
\DoxyCodeLine{106     \textcolor{keywordtype}{void} \mbox{\hyperlink{class_d_a_w_a847f0add89099e32ce736b006f1cf914}{draw}}(GFXcanvas1 * screen) \textcolor{keyword}{override};}
\DoxyCodeLine{107 }
\DoxyCodeLine{108 \textcolor{keyword}{private}:}
\DoxyCodeLine{109 }
\DoxyCodeLine{110     GFXcanvas1 * screen;}
\DoxyCodeLine{111 }
\DoxyCodeLine{112     std::mutex midiLock;}
\DoxyCodeLine{113     std::deque<MData> midiQueue;}
\DoxyCodeLine{114 }
\DoxyCodeLine{115     \textcolor{keyword}{static} \mbox{\hyperlink{class_rack}{Rack}} * spawnTracksRack(\textcolor{keywordtype}{int} n);}
\DoxyCodeLine{116     \textcolor{keyword}{static} \mbox{\hyperlink{class_rack}{Rack}} * spawnTapeRack(\textcolor{keywordtype}{int} n);}
\DoxyCodeLine{117     \textcolor{keyword}{static} \mbox{\hyperlink{class_rack}{Rack}} * spawnSingleTrack();}
\DoxyCodeLine{118     \textcolor{keyword}{static} \mbox{\hyperlink{class_rack}{Rack}} * spawnSingleTrack(\textcolor{keyword}{const} \textcolor{keywordtype}{char} * name, \textcolor{keywordtype}{int} i, \textcolor{keywordtype}{int} j, \textcolor{keywordtype}{int} k);}
\DoxyCodeLine{119     \textcolor{keyword}{static} \mbox{\hyperlink{class_rack}{Rack}} * spawnMidiRack();}
\DoxyCodeLine{120     \textcolor{keyword}{static} \mbox{\hyperlink{class_rack}{Rack}} * spawnInstrumentRack();}
\DoxyCodeLine{121     \textcolor{keyword}{static} \mbox{\hyperlink{class_rack}{Rack}} * spawnEffectRack();}
\DoxyCodeLine{122 }
\DoxyCodeLine{123     \mbox{\hyperlink{class_rack}{Rack}} * tracks;}
\DoxyCodeLine{124     \mbox{\hyperlink{class_tape_rack}{TapeRack}} * tapes;}
\DoxyCodeLine{125     \mbox{\hyperlink{class_rack}{Rack}} * focus\_rack;}
\DoxyCodeLine{126 }
\DoxyCodeLine{127     MIDISTATUS dawMidiStatus;}
\DoxyCodeLine{128 }
\DoxyCodeLine{129     \mbox{\hyperlink{class_m_i_d_i_map}{MIDIMap}} * midiMap;}
\DoxyCodeLine{130 }
\DoxyCodeLine{131     \textcolor{keywordtype}{float} avg = 0;}
\DoxyCodeLine{132     \textcolor{keywordtype}{float} avg\_env = 0;}
\DoxyCodeLine{133     \textcolor{keyword}{inline} \textcolor{keywordtype}{float} envelope(\textcolor{keywordtype}{float} sample, \textcolor{keywordtype}{float} w, \textcolor{keywordtype}{float} w\_env) \{}
\DoxyCodeLine{134         avg = w * sample + (1 -\/ w) * avg;}
\DoxyCodeLine{135         \textcolor{keywordtype}{float} i = std::abs(sample -\/ avg);}
\DoxyCodeLine{136         avg\_env = w\_env * i + (1 -\/ w\_env) * avg\_env;}
\DoxyCodeLine{137         \textcolor{keywordflow}{return} avg\_env;}
\DoxyCodeLine{138     \}}
\DoxyCodeLine{139 \};}
\DoxyCodeLine{140 }

\end{DoxyCode}
